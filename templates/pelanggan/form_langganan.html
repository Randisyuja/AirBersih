{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load rupiah_filters %}

    <h1>{% if object %}Edit{% else %}Tambah{% endif %} Langganan</h1>

    <form method="post">
        {% csrf_token %}
        <div class="mb-3">
            <label for="id_pelanggan" class="form-label">Pelanggan</label>
            {{ form.pelanggan }}
        </div>

        <div class="mb-3">
            <label for="id_jenis" class="form-label">Jenis Layanan</label>
            {{ form.jenis_layanan }}
        </div>

        <div class="mb-3">
            <label for="id_harga" class="form-label">Harga</label>
            {{ form.harga }}
        </div>

        <div class="mb-3">
            <label for="id_aktif" class="form-label">Aktif</label>
            {{ form.aktif }}
        </div>

        <button type="submit" class="btn btn-success">Simpan</button>
        <a href="{% url 'daftar_langganan' %}" class="btn btn-secondary">Batal</a>
    </form>

    <script>
        $("#id_jenis_layanan").change(function () {
            var jenisId = $(this).val();
            console.log("Jenis ID dipilih di dropdown:", jenisId);

            if (jenisId) {
                $.ajax({
                    url: "{% url 'get_harga_jenis' %}",
                    data: {'jenis_id': jenisId},
                    success: function (data) {
                        console.log("✅ Data dari server:", data);
                        $("#id_harga").val(data.harga);
                    },
                    error: function (xhr, status, error) {
                        console.error("❌ AJAX Error:", status, error);
                        console.log("Response:", xhr.responseText);
                    }
                });
            } else {
                $("#id_harga").val("");
            }
        });
    </script>

{% endblock %}