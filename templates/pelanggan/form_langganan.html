{% extends 'base.html' %}
{% block content %}
{% load static %}
{% load rupiah_filters %}

    <div class="container-fluid">
        <h1 class="h3 mb-3 text-gray-800">
            {% if object %}
                Edit Langganan
            {% else %}
                Tambah Langganan
            {% endif %}
        </h1>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-success btn-icon-split"> 
                <span class="icon text-white-50">
                    <i class="fas fa-check"></i>
                </span>
                <span class="text">
                    Simpan
                </span>
            </button>
            <a href="{% url 'daftar_langganan' %}" class="btn btn-secondary btn-icon-split">
                <span class="icon text-white-50">
                    <i class="fas fa-arrow-left"></i>
                </span>
                <span class="text">Kembali</span>
            </a>
        </form>
    </div>

    <script>
        $("#id_jenis_layanan").change(function () {
            var jenisId = $(this).val();
            console.log("Jenis ID dipilih di dropdown:", jenisId);

            if (jenisId) {
                $.ajax({
                    url: "{% url 'get_harga_jenis' %}",
                    data: {'jenis_id': jenisId},
                    success: function (data) {
                        console.log("✅ Data dari server:", data);
                        $("#id_harga").val(data.harga);
                    },
                    error: function (xhr, status, error) {
                        console.error("❌ AJAX Error:", status, error);
                        console.log("Response:", xhr.responseText);
                    }
                });
            } else {
                $("#id_harga").val("");
            }
        });
    </script>

{% endblock %}